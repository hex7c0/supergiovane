/*
 * supergiovane v1.0.9
 * (c) hex7c0 http://supergiovane.tk
 * Licensed under GPLv3
 */
"use strict";function bootstrap(a){var b=express();return b.set("env",a.env),"production"==a.env?b.enable("view cache"):b.disable("view cache"),b.enable("case sensitive routing"),b.enable("strict routing"),b.enable("trust proxy"),b.disable("x-powered-by"),b.disable("etag"),b.use(logger(a.logger)),b.use(timeout(a.timeout)),b.use(compression(a.compression)),sitemap(a.sitemap).TXTtoFile(),b.get("/:pkg/",function(a,b){var c=a.params.pkg;if("string"==typeof c){var d=http.request({host:"registry.npmjs.org",port:80,path:"/"+c,method:"GET",headers:{"User-Agent":"supergiovane@"+VERSION,hi_guys:"JSOP_will_be_great_feature"}},function(a){var c="";200==a.statusCode||304==a.statusCode?(a.setEncoding("utf8"),a.on("data",function(a){c+=a}),a.on("end",function(){c.readme=null,b.end(c)})):b.status(404).end()});a.on("error",function(){b.status(404).end()}),d.end()}else b.status(404).end()}),b.use(function(a,b,c,d){var e=0;switch(a.message.toLowerCase()){case"not found":d();break;case"unauthorized":e=401;break;case"forbidden":e=403;break;case"bad gateway":e=502;break;default:e=500}c.status(e).end()}),b.use(function(a,b){var c=404;b.status(c).end()}),console.log(process.pid+" | listening on: "+a.host+":"+a.port),http.createServer(b).listen(a.port,a.host),b}var VERSION="1.0.9";try{var cluster=require("cluster"),cpu=require("os").cpus().length,compression=require("compression"),express=require("express"),sitemap=require("express-sitemap"),http=require("http"),logger=require("logger-request"),timeout=require("timeout-request")}catch(MODULE_NOT_FOUND){console.error(MODULE_NOT_FOUND),process.exit(1)}module.exports=function(a){var a=a||Object.create(null),b={env:String(a.env||"production"),host:String(a.host||"127.0.0.1"),port:Number(a.port)||3e3,dir:String(a.dir||__dirname+"/public/"),logger:a.logger||Object.create(null),timeout:a.timeout||Object.create(null),compression:a.compression||Object.create(null),sitemap:a.sitemap||Object.create(null)};if("development"==b.env)return bootstrap(b);if(!cluster.isMaster)return bootstrap(b);for(var c=0;cpu>c;c++)cluster.fork();cluster.on("exit",function(a,b,c){console.warn(a.process.pid+" died by "+c)})};