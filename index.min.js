/*
 * supergiovane v1.0.0
 * (c) hex7c0 http://supergiovane.tk
 * Licensed under GPLv3
 */
"use strict";var VERSION="1.0.0";try{var cluster=require("cluster"),cpu=require("os").cpus().length,compression=require("compression"),app=require("express")(),sitemap=require("express-sitemap"),http=require("http"),logger=require("logger-request"),timeout=require("timeout-request")}catch(MODULE_NOT_FOUND){console.error(MODULE_NOT_FOUND),process.exit(1)}module.exports=function(a){var a=a||Object.create(null),b={env:String(env||"production"),port:Number(a.port)||3e3,dir:String(a.dir||__dirname+"/public/"),logger:logger||Object.create(null),timeout:timeout||Object.create(null),compression:compression||Object.create(null)};if(!cluster.isMaster)return app.set("env",b.env),"production"==b.env?app.enable("view cache"):app.disable("view cache"),app.enable("case sensitive routing"),app.enable("strict routing"),app.enable("trust proxy"),app.disable("x-powered-by"),app.disable("etag"),app.use(logger(b.logger)),app.use(timeout(b.timeout)),app.use(compression(b.compression)),app.get("/",function(a,c){c.sendfile(b.dir+"index.min.html")}),app.get("/:pkg/",function(a,b){var c=http.request({host:"registry.npmjs.org",port:80,path:"/"+a.params.pkg,method:"GET",headers:{"User-Agent":"supergiovane-"+VERSION},agent:!1},function(a){var c="";200==a.statusCode||304==a.statusCode?(a.setEncoding("utf8"),a.on("data",function(a){c+=a}),a.on("end",function(){c.readme=null,b.end(c)})):b.status(404).end()});a.on("error",function(){b.status(404).end()}),c.end()}),app.use(function(a,b,c,d){var e=0;switch(a.message.toLowerCase()){case"not found":d();break;case"unauthorized":e=401;break;case"forbidden":e=403;break;case"bad gateway":e=502;break;default:e=500}c.status(e).end()}),app.use(function(a,b){var c=404;b.status(c).end()}),console.log(process.pid+" | listening on port: "+b.port),void http.createServer(app).listen(b.port);for(var c=0;cpu>c;c++)cluster.fork();CLUSTER.on("exit",function(a,b,c){console.warn(a.process.pid+" died by "+c)})};